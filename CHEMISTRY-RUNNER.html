<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Chem Runner</title>
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
      }
      .game {
        position: relative;
        width: 100%;
        height: 100%;
        overflow: hidden;
        /* background: #f3f4f6; */
        font-family: system-ui, Segoe UI, Roboto, Arial;
        /* From Uiverse.io by csemszepp */ 
          /* --s: 200px;
        --c1: #1d1d1d;
        --c2: #4e4f51;
        --c3: #3c3c3c;
        background: repeating-conic-gradient(
              from 30deg,
              #0000 0 120deg,
              var(--c3) 0 180deg
            )
            calc(0.5 * var(--s)) calc(0.5 * var(--s) * 0.577),
          repeating-conic-gradient(
            from 30deg,
            var(--c1) 0 60deg,
            var(--c2) 0 120deg,
            var(--c3) 0 180deg
          );
        background-size: var(--s) calc(var(--s) * 0.577); */
        /* Adapted From Uiverse.io by FColombati */ 
        overflow: hidden;
        background-repeat: repeat;
        background-position: 50% 50%;
        background-size: 154px 265px;
        background-image: 
            conic-gradient(from 0deg at 92.66% 50%, #2c2c2c 0 120deg, #0000 0 100%),
            conic-gradient(from -60deg at 81.66% 10.25%, #3a3a3a 0 180deg, #0000 0 100%),
            conic-gradient(from -60deg at 66.66% 22.25%, #4d4d4d 0 120deg, #0000 0 100%),
            conic-gradient(from 0deg at 71.66% 43%, #1f1f1f 0 120deg, #0000 0 100%),
            conic-gradient(from 0deg at 66.66% 45.95%, #1f1f1f 0 60deg, #0000 0 100%),
            conic-gradient(from 120deg at 25% 91.5%, #4d4d4d 0 120deg, #0000 0 100%),
            conic-gradient(from 180deg at 16% 73.5%, #2c2c2c 0 120deg, #0000 0 100%),
            conic-gradient(from 180deg at 16% 73.5%, #2c2c2c 0 120deg, #0000 0 100%),
            conic-gradient(from 180deg at 16% 73.5%, #2c2c2c 0 120deg, #0000 0 100%),
            conic-gradient(from 180deg at 16% 73.5%, #2c2c2c 0 120deg, #0000 0 100%),
            conic-gradient(from 180deg at 39.5% 65.65%, #1f1f1f 0 60deg, #4d4d4d 0 120deg, #0000 0 100%),
            conic-gradient(from 180deg at 39.5% 65.65%, #1f1f1f 0 60deg, #4d4d4d 0 120deg, #0000 0 100%),
            conic-gradient(from 180deg at 39.5% 65.65%, #1f1f1f 0 60deg, #4d4d4d 0 120deg, #0000 0 100%),
            conic-gradient(from 180deg at 39.5% 65.65%, #1f1f1f 0 60deg, #4d4d4d 0 120deg, #0000 0 100%),
            conic-gradient(from 60deg at 50% 51.5%, #4d4d4d 0 60deg, #2c2c2c 0 120deg, #3a3a3a 0 100%);
          background-color: #0a0a0a; 
      }


      
      .character {
        position: absolute;
        width: 50px;
        height: 50px;
        left: calc(50% - 200px);
        top: calc(60vh - 5px);
        transition: top 0.35s ease-in;
      }
      .char-box {
        width: 50px;
        height: 50px;
        background: rgb(233, 163, 25);
        border-top: 5px solid rgb(225 147 55);
        border-bottom: 5px solid rgb(225 147 55);
        border-left: 5px solid rgb(225 147 55);
        border-right: 5px solid rgb(225 147 55);


      }
      .strip {
        position: absolute;
        left: 0;
        right: 0;
        top: calc(60vh + 55px);
        height: 140px;
        pointer-events: none;
      }
      .block {
        position: absolute;
        width: 100px;
        height: 100px;
        /* background: #cbd5e1; */
        border: 2px solid rgba(0, 0, 0, 0.06);
        box-sizing: border-box;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        user-select: none;
        /* From Uiverse.io by kennyotsu-monochromia */ 
        --color: #bfbfbf;
        background-color: #cecece;
        background-image: linear-gradient(0deg, transparent 24%, var(--color) 25%, var(--color) 26%, transparent 27%,transparent 74%, var(--color) 75%, var(--color) 76%, transparent 77%,transparent),
            linear-gradient(90deg, transparent 24%, var(--color) 25%, var(--color) 26%, transparent 27%,transparent 74%, var(--color) 75%, var(--color) 76%, transparent 77%,transparent);
        background-size: 55px 55px;
        /*  */
        /* animate vertical movement */
        transition: transform 0.35s ease-out;
        transform: translateY(100vh);
      }
      .ui {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        top: 33vh;
        text-align: center;
      }
      .inp {
        width: 420px;
        padding: 10px 12px;
        font-size: 18px;
        border: 1px solid #cbd5e1;
        border-radius: 6px;
      }
      /* .hint {
        margin-top: 8px;
        color: white;
        color: #374151;
        font-size: 18px;
        font-family: Georgia, 'Times New Roman', Times, serif;
      } */

      .hint {
        border-radius: 10px;
        border: 0;
        font-family: 'Helvetica Neue', sans-serif;
        background-color: #ffffff;
        padding: 5px;
        margin-top: 10px;
        margin-left: 25px;
        width: 400px;
      }


      .status {
        position: absolute;
        right: 12px;
        top: 12px;
        color: #374151;
        font-size: 13px;
      }
      .panel {
        position: absolute;
        left: 12px;
        top: 12px;
        width: 365px;
        background: oklab(100% 0 -0.00011);
        border: 2px solid #d5ddec;
        padding: 10px;
        padding-top: 20px;
        border-radius: 6px;
        overflow: hidden;
        height: 100px;  
        /* height: 0px;  */
        padding-top: 100px;
        transition: width 0.3s ease, height 0.3s ease;
        padding: 6px;
      }
      .panel:hover {
        height: 100px;  
      }

      textarea {
        width: 100%;
        height: 120px;
        font-family: monospace;
        margin-top: 6px;
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #e5e7eb;
      }
      .small {
        font-size: 12px;
        color: #6b7280;
        margin-top: 6px;
      }






      .underline-select {
        position: relative;
        text-align: center;
        top: 15%;
        left: 10px;
        display: block;
        width: 15%;
        padding: 10px;
        font-size: 14px;
        color: #494949;            /* gray-500 */
        background: white;
        border-bottom: 2px solid #d5ddec;
        border-top: none;
        border-left: none;
        border-right: none;

        appearance: none;
      }
      .underline-select:focus {
        outline: none;
        border-bottom-color: #9ca3af; /* gray-400 */
      }


      /* Based on element From Uiverse.io by absoluteSTrange */ 
      .menu-button {
        padding: 3px 9px;
        border-radius: 10px;
        border: 0;
        background-color: rgb(255, 56, 86);
        letter-spacing: 1.5px;
        font-size: 15px;
        transition: all 0.3s ease;
        box-shadow: rgb(201, 46, 70) 0px 7px 0px 0px;
        color: hsl(0, 0%, 100%);
        cursor: pointer;
      }
      .menu-button:hover {
        box-shadow: rgb(201, 46, 70) 0px 7px 0px 0px;
      }
      .menu-button:active {
        background-color: rgb(255, 56, 86);
        box-shadow: rgb(201, 46, 70) 0px 0px 0px 0px;
        transform: translateY(5px);
        transition: 200ms;
      }

      /* From Uiverse.io by cohencoo */ 
      #input {
        border-radius: 10px;
        outline: 2px solid #e2e2e2;     /* outline: 2px solid #FEBF00; */
        border: 0;
        font-family: 'Helvetica Neue', sans-serif;
        background-color: #ffffff;
        outline-offset: 3px;
        padding: 10px 1rem;
        transition: 0.25s;
      }
      #input:focus {
        outline-offset: 5px;
        background-color: #fff
      }


      /* From Uiverse.io by satisshTechie */ 
      #speedSlider {
        width: 100%;
        height: 4px;
        border-radius: 5px;
        background: #D5DBE1;
        outline: none;
        opacity: 0.7;
        -webkit-transition: .2s;
        transition: opacity .2s;
      }
      #speedSlider::-webkit-slider-thumb {
        appearance: none;
        width: 15px;
        height: 15px;
        border-radius: 50%;
        background-color: #000000;
        cursor: pointer;
        transition: 0.3s ease-in-out;
      }
      #speedSlider:hover {
        box-shadow: 0px 0px 0px 8px rgba(0, 0, 0, 0.16);
        transition: 0.1s ease-in-out;
      }
      #speedSlider::-moz-range-thumb {
        width: 15px;
        height: 15px;
        border-radius: 50%;
        background-color: #000000;
        cursor: pointer;
      }
      #speedSliderDiv {
        position: absolute; 
        top: 12px; 
        left: 400px; 
        align-items: center; 
        gap: 6px;
        background-color: #e4e4e4;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 1rem;
        padding: 1rem;
        border-radius: 6px;
        border: 1px solid #C6CACE;
        box-shadow: 0px 1px 2px 0px #1F1E241F;
      }
      #speedValue {
        font-weight: 600;
      }

    </style>
  </head>
  <body>
    <div id="game" class="game">
      <div id="character" class="character" aria-hidden>
        <div class="char-box"></div>
      </div>

      <div id="strip" class="strip"></div>


      <!-- From Uiverse.io by cohencoo --> 
      <form id="form" class="ui" autocomplete="off">
        <input
          id="input"
          class="inp"
          placeholder="Answer correctly to begin..."
          autofocus
        />
        <div id="hint" class="hint"></div>
      </form>

      <div id="status" class="status"></div>

      <div class="panel">
        <div style="display: flex; gap: 6px; margin-top: 6px">
          <button onclick="location.href='index.html'" class="menu-button">Home</button>
          <input type="button" id="restartBtn" value="Restart" class="menu-button" />
          <button class="menu-button" onclick="ScrambleData()">Scramble Data</button>
          <button class="menu-button" onclick="ReverseData()">Reverse Data</button>
        </div>
      </div>
      <div id="speedSliderDiv">
        <label for="speedSlider">Speed:</label>
        <input type="range" id="speedSlider" min="1" max="10" value="5">
        <span id="speedValue">5</span>
      </div>





      <select id="Select_Answer_Key" class="underline-select" onchange="handleOption()">
        <option value="">--Select Answer Key--</option>
        <option value="Element_Names">Element Names</option>
        <option value="Element_Symbols">Element Symbols</option>
        <option value="Element_Atomic_Numbers">Element Atomic Numbers</option>
        <option value="Element_Atomic_Masses">Element Atomic Masses</option>
        <option value="Common_Polyatomic_Ions_Names">Common Polyatomic Ions Names</option>
        <option value="Common_Polyatomic_Ions_Formulas">Common Polyatomic Ions Formulas</option>
      </select>
      <select id="Select_Hint_Key" class="underline-select" onchange="handleOption()">
        <option value="">--Select Hint Key--</option>
        <option value="Element_Names">Element Names</option>
        <option value="Element_Symbols">Element Symbols</option>
        <option value="Element_Atomic_Numbers">Element Atomic Numbers</option>
        <option value="Element_Atomic_Masses">Element Atomic Masses</option>
        <option value="Common_Polyatomic_Ions_Names">Common Polyatomic Ions Names</option>
        <option value="Common_Polyatomic_Ions_Formulas">Common Polyatomic Ions Formulas</option>
      </select>



    </div>

    <script>


      // ############ DATA ############
      window.Element_Names = [
        "Hydrogen",
        "Helium",
        "Lithium",
        "Beryllium",
        "Boron",
        "Carbon",
        "Nitrogen",
        "Oxygen",
        "Fluorine",
        "Neon",
        "Sodium",
        "Magnesium",
        "Aluminium",
        "Silicon",
        "Phosphorus",
        "Sulfur",
        "Chlorine",
        "Argon",
        "Potassium",
        "Calcium",
        "Scandium",
        "Titanium",
        "Vanadium",
        "Chromium",
        "Manganese",
        "Iron",
        "Cobalt",
        "Nickel",
        "Copper",
        "Zinc",
        "Gallium",
        "Germanium",
        "Arsenic",
        "Selenium",
        "Bromine",
        "Krypton",
        "Rubidium",
        "Strontium",
        "Yttrium",
        "Zirconium",
        "Niobium",
        "Molybdenum",
        "Technetium",
        "Ruthenium",
        "Rhodium",
        "Palladium",
        "Silver",
        "Cadmium",
        "Indium",
        "Tin",
        "Antimony",
        "Tellurium",
        "Iodine",
        "Xenon",
        "Caesium",
        "Barium",
        "Lanthanum",
        "Cerium",
        "Praseodymium",
        "Neodymium",
        "Promethium",
        "Samarium",
        "Europium",
        "Gadolinium",
        "Terbium",
        "Dysprosium",
        "Holmium",
        "Erbium",
        "Thulium",
        "Ytterbium",
        "Lutetium",
        "Hafnium",
        "Tantalum",
        "Tungsten",
        "Rhenium",
        "Osmium",
        "Iridium",
        "Platinum",
        "Gold",
        "Mercury",
        "Thallium",
        "Lead",
        "Bismuth",
        "Polonium",
        "Astatine",
        "Radon",
        "Francium",
        "Radium",
        "Actinium",
        "Thorium",
        "Protactinium",
        "Uranium",
        "Neptunium",
        "Plutonium",
        "Americium",
        "Curium",
        "Berkelium",
        "Californium",
        "Einsteinium",
        "Fermium",
        "Mendelevium",
        "Nobelium",
        "Lawrencium",
        "Rutherfordium",
        "Dubnium",
        "Seaborgium",
        "Bohrium",
        "Hassium",
        "Meitnerium",
        "Darmstadtium",
        "Roentgenium",
        "Copernicium",
        "Nihonium",
        "Flerovium",
        "Moscovium",
        "Livermorium",
        "Tennessine",
        "Oganesson",
      ];
      window.Element_Symbols = [
        "H",
        "He",
        "Li",
        "Be",
        "B",
        "C",
        "N",
        "O",
        "F",
        "Ne",
        "Na",
        "Mg",
        "Al",
        "Si",
        "P",
        "S",
        "Cl",
        "Ar",
        "K",
        "Ca",
        "Sc",
        "Ti",
        "V",
        "Cr",
        "Mn",
        "Fe",
        "Co",
        "Ni",
        "Cu",
        "Zn",
        "Ga",
        "Ge",
        "As",
        "Se",
        "Br",
        "Kr",
        "Rb",
        "Sr",
        "Y",
        "Zr",
        "Nb",
        "Mo",
        "Tc",
        "Ru",
        "Rh",
        "Pd",
        "Ag",
        "Cd",
        "In",
        "Sn",
        "Sb",
        "Te",
        "I",
        "Xe",
        "Cs",
        "Ba",
        "La",
        "Ce",
        "Pr",
        "Nd",
        "Pm",
        "Sm",
        "Eu",
        "Gd",
        "Tb",
        "Dy",
        "Ho",
        "Er",
        "Tm",
        "Yb",
        "Lu",
        "Hf",
        "Ta",
        "W",
        "Re",
        "Os",
        "Ir",
        "Pt",
        "Au",
        "Hg",
        "Tl",
        "Pb",
        "Bi",
        "Po",
        "At",
        "Rn",
        "Fr",
        "Ra",
        "Ac",
        "Th",
        "Pa",
        "U",
        "Np",
        "Pu",
        "Am",
        "Cm",
        "Bk",
        "Cf",
        "Es",
        "Fm",
        "Md",
        "No",
        "Lr",
        "Rf",
        "Db",
        "Sg",
        "Bh",
        "Hs",
        "Mt",
        "Ds",
        "Rg",
        "Cn",
        "Nh",
        "Fl",
        "Mc",
        "Lv",
        "Ts",
        "Og",
      ];

      // --- yet to be verified --- //
      window.Element_Atomic_Numbers = [
        "1",
        "2",
        "3",
        "4",
        "5",
        "6",
        "7",
        "8",
        "9",
        "10",
        "11",
        "12",
        "13",
        "14",
        "15",
        "16",
        "17",
        "18",
        "19",
        "20",
        "21",
        "22",
        "23",
        "24",
        "25",
        "26",
        "27",
        "28",
        "29",
        "30",
        "31",
        "32",
        "33",
        "34",
        "35",
        "36",
        "37",
        "38",
        "39",
        "40",
        "41",
        "42",
        "43",
        "44",
        "45",
        "46",
        "47",
        "48",
        "49",
        "50",
        "51",
        "52",
        "53",
        "54",
        "55",
        "56",
        "57",
        "58",
        "59",
        "60",
        "61",
        "62",
        "63",
        "64",
        "65",
        "66",
        "67",
        "68",
        "69",
        "70",
        "71",
        "72",
        "73",
        "74",
        "75",
        "76",
        "77",
        "78",
        "79",
        "80",
        "81",
        "82",
        "83",
        "84",
        "85",
        "86",
        "87",
        "88",
        "89",
        "90",
        "91",
        "92",
        "93",
        "94",
        "95",
        "96",
        "97",
        "98",
        "99",
        "100",
        "101",
        "102",
        "103",
        "104",
        "105",
        "106",
        "107",
        "108",
        "109",
        "110",
        "111",
        "112",
        "113",
        "114",
        "115",
        "116",
        "117",
        "118",
      ];
      window.Element_Atomic_Masses = [
        "1.008",
        "4.0026",
        "6.94",
        "9.0122",
        "10.81",
        "12.011",
        "14.007",
        "15.999",
        "18.998",
        "20.180",
        "22.990",
        "24.305",
        "26.982",
        "28.085",
        "30.974",
        "32.06",
        "35.45",
        "39.948",
        "39.098",
        "40.078",
        "44.956",
        "47.867",
        "50.942",
        "51.996",
        "54.938",
        "55.845",
        "58.933",
        "58.693",
        "63.546",
        "65.38",
        "69.723",
        "72.630",
        "74.922",
        "78.971",
        "79.904",
        "83.798",
        "85.468",
        "87.62",
        "88.906",
        "91.224",
        "92.906",
        "95.95",
        "98",
        "101.07",
        "102.91",
        "106.42",
        "107.87",
        "112.41",
        "114.82",
        "118.71",
        "121.76",
        "127.60",
        "126.90",
        "131.29",
        "132.91",
        "137.33",
        "138.91",
        "140.12",
        "140.91",
        "144.24",
        "145",
        "150.36",
        "151.96",
        "157.25",
        "158.93",
        "162.50",
        "164.93",
        "167.26",
        "168.93",
        "173.05",
        "174.97",
        "178.49",
        "180.95",
        "183.84",
        "186.21",
        "190.23",
        "192.22",
        "195.08",
        "196.97",
        "200.59",
        "204.38",
        "207.2",
        "208.98",
        "209",
        "210",
        "222",
        "223",
        "226",
        "227",
        "232.04",
        "231.04",
        "238.03",
        "237",
        "244",
        "243",
        "247",
        "247",
        "251",
        "252",
        "257",
        "258",
        "259",
        "262",
        "267",
        "270",
        "271",
        "270",
        "277",
        "278",
        "281",
        "282",
        "285",
        "286",
        "289",
        "290",
        "293",
        "294",
        "294",
      ];
      // --- yet to be verified --- //
      //
   window.Common_Polyatomic_Ions_Names = [
        "Acetate",
        "Carbonate",
        "Hydroxide",
        "Nitrite",
        "Nitrate",
        "Chromate",
        "Dichromate",
        "Phosphate",
        "Ammonium",
        "Hypochlorite",
        "Chlorite",
        "Chlorate",
        "Perchlorate",
        "Permanganate",
        "Sulfite",
        "Sulfate",
        "Cyanide",
        "Peroxide",
        "Iodate",
      ];
      window.Common_Polyatomic_Ions_Formulas = [
        "C2H3O2 MINUS ONE",
        "CO3 MINUS TWO",
        "OH MINUS ONE",
        "NO2 MINUS ONE",
        "NO3 MINUS ONE",
        "CrO4 MINUS TWO",
        "Cr2O7 MINUS TWO",
        "PO4 MINUS THREE",
        "NH4 PLUS ONE",
        "ClO MINUS ONE",
        "ClO2 MINUS ONE",
        "ClO3 MINUS ONE",
        "ClO4 MINUS ONE",
        "MnO4 MINUS ONE",
        "SO3 MINUS TWO",
        "SO4 MINUS TWO",
        "CN MINUS ONE",
        "O2 MINUS TWO",
        "IO3 MINUS ONE",
      ];
      //

      // notes:
      // add character png to have that
      // can also add in the future sort of progression rewards the further you go
      // later, add,
      // naming rules
      // aufbau filling order
      // periodic table trends

      // ############ DATA ############

      // ############ CONFIG ############
      let answerKey = Common_Polyatomic_Ions_Formulas;
      let hintBook = Common_Polyatomic_Ions_Names;
      const BLOCK_W = 100;
      const GAP = 5;
      const STEP = BLOCK_W + GAP;
      let SECONDS_PER_BLOCK = 5; // each block gives user 1 seconds
      let SPEED = STEP / SECONDS_PER_BLOCK; // px/s



      //to learn, start at 10s and complete the game there, then slowly reduce the seconds by one. 
      //then do the same in reverse then
      //scramble it.
      // ############ CONFIG ############

      // ############# - CONTROLS - ##############
      function handleOption() {
        const Select_Hint_Key = document.getElementById("Select_Hint_Key");
        const Select_Answer_Key = document.getElementById("Select_Answer_Key");

        if (Select_Hint_Key.value !== "" && Select_Answer_Key.value !== "") {
          setData(Select_Answer_Key.value, Select_Hint_Key.value);

          // const HK = window[Select_Hint_Key.value];
          // const AK = window[Select_Answer_Key.value];

          // if (Array.isArray(HK) && Array.isArray(AK)) {
          //   setData(AK, HK);
          //   console.log("handleOption - Changed Data");
          // } else {
          //   console.error("handleOption - Invalid sources:", HK, AK);
          // }
        }
      }


      const speedSlider = document.getElementById("speedSlider");
      const speedValue = document.getElementById("speedValue");
      let val = 11 - Number(speedSlider.value);
      speedValue.innerHTML = `${val} <span style="font-size:0.8em; color:gray;">(seconds/block)</span>`;
      speedSlider.addEventListener("input", () => {
        val = 11 - Number(speedSlider.value);
        speedValue.innerHTML = `${val} <span style="font-size:0.8em; color:gray;">(seconds/block)</span>`;
        SECONDS_PER_BLOCK = val;            // update global speed
        SPEED = STEP / SECONDS_PER_BLOCK;   // recalc SPEED
        console.log("Val:", val, " | SECONDS_PER_BLOCK:", SECONDS_PER_BLOCK)
      });

      // Replace answerKey and hintBook from arrays or by global name (string).
      function setData(answerSrc, hintSrc) {
        const resolve = (src) => {
          if (typeof src === "string") {
            if (window[src] && Array.isArray(window[src]))
              return window[src].slice();
            return null;
          }
          if (Array.isArray(src)) return src.slice();
          return null;
        };
        const newAnswers = resolve(answerSrc);
        const newHints = resolve(hintSrc);
        if (!newAnswers || !newHints) {
          console.error(
            "setData: invalid sources. Pass array or global array name string."
          );
          return false;
        }
        answerKey.splice(0, answerKey.length, ...newAnswers);
        hintBook.splice(0, hintBook.length, ...newHints);
        answerIndex = 0;
        input.value = "";
        input.disabled = false;
        character.style.top = "60vh";
        blocks.forEach((b) => b.el.remove());
        blocks = [];
        nextId = 0;
        initPlatform();
        preloadBlocksToCoverScreen();
        return true;
      }
      window.setData = setData;

      // function ScrambleData(){
      //     // get time seconds, use randomization algorithm on the milliseconds number of the time
      //     // for all answers in answerKey, have a randomized number
      //     // rearrange the answers in answerKey according to that randomized number, and mirror those actions relative to position onto hintsBook
      // }
      function ScrambleData() {
        const now = Date.now();
        const seed = now % 1000;
        function mulberry32(a) {
          return function () {
            a |= 0;
            a = (a + 0x6d2b79f5) | 0;
            let t = Math.imul(a ^ (a >>> 15), 1 | a);
            t = (t + Math.imul(t ^ (t >>> 7), 61 | t)) ^ t;
            return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
          };
        }
        const rand = mulberry32(seed);
        const n = Math.min(answerKey.length, hintBook.length);
        const indices = Array.from({ length: n }, (_, i) => i)
          .map((i) => ({ i, k: rand() }))
          .sort((a, b) => a.k - b.k)
          .map((o) => o.i);
        const newAnswers = indices.map((i) => answerKey[i]);
        const newHints = indices.map((i) => hintBook[i]);
        if (answerKey.length > n) newAnswers.push(...answerKey.slice(n));
        if (hintBook.length > n) newHints.push(...hintBook.slice(n));
        answerKey.length = 0;
        answerKey.push(...newAnswers);
        hintBook.length = 0;
        hintBook.push(...newHints);
        return seed;
      }
      function ReverseData() {
        answerKey.reverse();
        hintBook.reverse();
      }


      // ############# - CONTROLS - ##############

      // ############# - Variables - ##############
      let containerW = window.innerWidth;
      let blocks = [];
      let nextId = 0;
      let lastTs = null;
      let running = true;
      let answerIndex = 0;
      let falling = false;
      let revealLastId = null;
      const strip = document.getElementById("strip");
      const input = document.getElementById("input");
      const hintEl = document.getElementById("hint");
      const status = document.getElementById("status");
      const character = document.getElementById("character");

      function nextElementIsNone() {
        return answerIndex === null || answerIndex === undefined;
      }
      function setNextElementIndex(i) {
        answerIndex = i;
      }
      // ############# - Variables - ##############

      // ############# - Blocks - ##############
      function charX() {
        return containerW / 2 - 200;
      }
      function createBlock(x, label) {
        const el = document.createElement("div");
        el.className = "block";
        el.style.left = x + "px";
        el.dataset.label = label || "";
        el.textContent = label || "";
        strip.appendChild(el);
        requestAnimationFrame(() => {
          el.style.transform = "translateY(0)";
        });
        const b = { id: nextId++, x, el };
        blocks.push(b);
        return b;
      }
      function initPlatform() {
        containerW = window.innerWidth;
        blocks.forEach((b) => b.el.remove());
        blocks = [];
        nextId = 0;
        const cx = charX();
        const rightmostLeft = cx - BLOCK_W / 2;
        for (let i = 4; i >= 0; i--) {
          createBlock(rightmostLeft - i * STEP);
        }
      }
      function spawnBlockAtRight(label) {
        containerW = window.innerWidth;
        const rightmost = blocks.length
          ? Math.max(...blocks.map((b) => b.x))
          : -Infinity;
        const startX = isFinite(rightmost) ? rightmost + STEP : containerW + 10;
        return createBlock(startX, label);
      }
      // ############# - Blocks - ##############

      // ############# - Text Input - ##############
      function updateTextInput(str) {
        const raw = (str || "").trim();
        if (nextElementIsNone()) setNextElementIndex(0);
        const expected = answerKey[answerIndex];
        if (expected === undefined) return;
        if (raw.length > 0 && raw === expected.toString()) {
          const labelToWrite = raw.length ? raw : expected.toString();
          const b = spawnBlockAtRight(labelToWrite);
          b.el.dataset.label = labelToWrite;
          b.el.textContent = labelToWrite;
          answerIndex = Math.min(answerIndex + 1, answerKey.length);
          input.value = "";
          if (falling) {
            falling = false;
            character.style.top = "60vh";
          }
        }
      }
      // ############# - Text Input - ##############

      // ############# - Character - ##############
      function checkForFall() {
        const cx = charX();
        const charLeft = cx;
        const charRight = cx + 50; // 50 px character width
        const anyAhead = blocks.some((b) => b.x + BLOCK_W > charLeft + 1);
        const blockUnder = blocks.some(
          (b) => b.x <= charRight && b.x + BLOCK_W >= charLeft
        );
        if (!blockUnder && !anyAhead && !falling) {
          falling = true;
          character.style.top = "120vh";
          input.disabled = true;
          revealLastId = null;
          for (let i = 0; i < 5; i++) {
            // spawn the next 5 blocks
            const idx = answerIndex + i;
            const label = answerKey[idx];
            if (label === undefined) break;
            const b = spawnBlockAtRight(label);
            b.isReveal = true;
            b.el.dataset.label = label;
            b.el.textContent = label;
            b.el.style.color = "black";
            b.el.style.opacity = "0.5";
            revealLastId = b.id;
          }
        }
      }
      // ############# - Character - ##############

      // ############# - Controls - ##############
      function restartGame() {
        falling = false;
        revealLastId = null;
        input.disabled = false;
        input.value = "";
        answerIndex = 0;
        character.style.top = "60vh";
        blocks.forEach((b) => b.el.remove());
        blocks = [];
        nextId = 0;
        initPlatform();
        preloadBlocksToCoverScreen();
      }
      // ############# - Controls - ##############

      // ############# - Event Listeners - ##############
      input.addEventListener("input", (e) => updateTextInput(e.target.value));
      document.getElementById("form").addEventListener("submit", function (e) {
        e.preventDefault();
        updateTextInput(input.value);
      });
      window.addEventListener("resize", () => {
        containerW = window.innerWidth;
      });
      document
        .getElementById("restartBtn")
        .addEventListener("click", restartGame);
      const keysDown = new Set();

      document.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          restartGame();
        }
      });


      // ############# - Event Listeners - ##############

      // ############# - Main - ##############
      initPlatform();
      function preloadBlocksToCoverScreen() {
        containerW = window.innerWidth;
        const target = containerW + STEP * 1;
        let rightmost = blocks.length
          ? Math.max(...blocks.map((b) => b.x))
          : -Infinity;
        while (rightmost < target) {
          spawnBlockAtRight();
          rightmost = Math.max(...blocks.map((b) => b.x));
        }
      }
      preloadBlocksToCoverScreen();
      function loop(ts) {
        if (!lastTs) lastTs = ts;
        const dt = (ts - lastTs) / 1000;
        lastTs = ts;
        containerW = window.innerWidth;
        if (running) {
          if (answerIndex === 0) {
            let rightmost = blocks.length
              ? Math.max(...blocks.map((b) => b.x))
              : -Infinity;
            const target = containerW + STEP * 2;
            while (rightmost < target) {
              spawnBlockAtRight();
              rightmost = Math.max(...blocks.map((b) => b.x));
            }
          }
          for (const b of blocks) {
            b.x -= SPEED * dt;
            b.el.style.left = Math.round(b.x) + "px";
          }
          const keep = [];
          for (const b of blocks) {
            if (b.x + BLOCK_W > -200) {
              keep.push(b);
            } else {
              if (
                b.isReveal &&
                revealLastId !== null &&
                b.id === revealLastId
              ) {
                revealLastId = null;
                requestAnimationFrame(restartGame);
              }
              b.el.remove();
            }
          }
          blocks = keep;
          checkForFall();
          hintEl.textContent =
            answerIndex < hintBook.length
              ? hintBook[answerIndex]
              : "no more hints";
          status.textContent = `Restart Shortcut: 'Enter' | Index: ${answerIndex} | Blocks: ${blocks.length}`;
        }
        requestAnimationFrame(loop);
      }
      requestAnimationFrame(loop);
      // ############# - Main - ##############

      window.updateTextInput = updateTextInput;
      window.answerKey = answerKey;
      window.hintBook = hintBook;
    </script>
  </body>
</html>
